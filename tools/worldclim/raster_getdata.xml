<tool id="raster_getdata" name="Get climatic data from Worldclim" version="0.1.0">
    <macros>
        <import>raster_getdata_macro.xml</import> 
    </macros>
    <requirements>
        <requirement type="package" version="1.16.1">r-ncdf4</requirement>
        <requirement type="package" version="2.9_5">r-raster</requirement>
        <requirement type="package" version="1.4.0">r-stringr</requirement>
        <requirement type="package" version="0.2_16">r-codetools</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript 
            '$__tool_directory__/clim_data.R'
             'worldclim'
             '$var.usr_var'
             $usr_res
             CDF
             #if $var.condi_plot.plot=='yes_plot'
                '$var.usr_var$var.condi_plot.var_to_plot'
                '$var.condi_plot.usr_country'     
             #end if

    ]]></command>
    <inputs>
        <conditional name="var"> 
        <param name="usr_var" type="select" label="Variable" help="Temperature minimum, maximum, precipitations and bioclimatic variables.">
            <option value="tmin">tmin</option>
            <option value="tmax">tmax</option>
            <option value="prec">prec</option>
            <option value="bio">bio</option>
        </param>
            <when value="tmin">    
                <expand macro="wclim_plot"> 
                    <expand macro="wclim_tmin_tmax_prec"/> 
                </expand>
            </when>
            <when value="tmax">    
                <expand macro="wclim_plot"> 
                    <expand macro="wclim_tmin_tmax_prec"/> 
                </expand>
            </when>
            <when value="prec">    
                <expand macro="wclim_plot"> 
                    <expand macro="wclim_tmin_tmax_prec"/> 
                </expand>
            </when>
            <when value="bio">
                <expand macro="wclim_plot"> 
                    <option value="1">Annual Mean Temperature</option>
                    <option value="2">Mean Diurnal Range (Mean of monthly (max temp - min temp))</option>
                    <option value="3">Isothermality (BIO2/BIO7) (* 100)</option>
                    <option value="4">Temperature Seasonality (standard deviation *100)</option>
                    <option value="5">Max Temperature of Warmest Month</option>
                    <option value="6">Min Temperature of Coldest Month</option>
                    <option value="7">Temperature Annual Range (BIO5-BIO6)</option>
                    <option value="8">Mean Temperature of Wettest Quarter</option>
                    <option value="9">Mean Temperature of Driest Quarter</option>
                    <option value="10">Mean Temperature of Warmest Quarter</option>
                    <option value="11">Mean Temperature of Coldest Quarter</option>
                    <option value="12">Annual Precipitation</option>
                    <option value="13">Precipitation of Wettest Month</option>
                    <option value="14">Precipitation of Driest Month</option>
                    <option value="15">Precipitation Seasonality (Coefficient of Variation)</option>
                    <option value="16">Precipitation of Wettest Quarter</option>
                    <option value="17">Precipitation of Driest Quarter</option>
                    <option value="18">Precipitation of Warmest Quarter</option>
                    <option value="19">Precipitation of Coldest Quarter</option>
                </expand>
            </when>
        </conditional> 
        <param name="usr_res" type="select" label="Resolution" help="In minutes of a degree.">
            <option value="2.5">2.5</option>
            <option value="5">5</option>
            <option value="10">10</option>
        </param>
    </inputs>
    <outputs>
        <data name="output_df" from_work_dir="output_writeRaster.nc" format="netcdf" label="WorldClim data - NetCDF format"/>
        <data name="plot_jpeg" from_work_dir="worldclim_plot_usr_region.jpeg" format="jpg" label="WorldClim data - Visualisation">
            <filter> plot=='yes_plot'</filter>
        </data>
    </outputs>
    <help><![CDATA[

.. class:: infomark

=======================================
Get global climate data from Worldclim
=======================================

|

**What it does**

This tool retrieve global climate data from Wordclim using the R raster package.

The climatic data available are : 

  * Minimum temperature (°C x10)

  * Maximum temperature (°C x10)

  * Precipitation (mm)

  * Bioclimatic variables :
    
    * BIO1 = Annual Mean Temperature

    * BIO2 = Mean Diurnal Range (Mean of monthly (max temp - min temp))

    * BIO3 = Isothermality (BIO2/BIO7) (x 100)

    * BIO4 = Temperature Seasonality (standard deviation x100)

    * BIO5 = Max Temperature of Warmest Month

    * BIO6 = Min Temperature of Coldest Month

    * BIO7 = Temperature Annual Range (BIO5-BIO6)

    * BIO8 = Mean Temperature of Wettest Quarter

    * BIO9 = Mean Temperature of Driest Quarter

    * BIO10 = Mean Temperature of Warmest Quarter

    * BIO11 = Mean Temperature of Coldest Quarter

    * BIO12 = Annual Precipitation

    * BIO13 = Precipitation of Wettest Month

    * BIO14 = Precipitation of Driest Month

    * BIO15 = Precipitation Seasonality (Coefficient of Variation)

    * BIO16 = Precipitation of Wettest Quarter

    * BIO17 = Precipitation of Driest Quarter

    * BIO18 = Precipitation of Warmest Quarter

    * BIO19 = Precipitation of Coldest Quarter

|

**How to use it**

Simply select the variable to return and the resolution : 2.5, 5 or 10 minutes of a degree.

Available output format are : netcdf and grd (Native raster package format).

|

**Sources**

Worldclim : http://www.worldclim.org/

Raster package : https://cran.r-project.org/web/packages/raster/index.html

Raster package reference manual : https://cran.r-project.org/web/packages/raster/raster.pdf

    ]]></help>
    <expand macro="wclim_citation"/>
</tool>
